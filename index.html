<!DOCTYPE html>
<html lang="de">
<head>
    <!-- Head content -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHY1 PDF Generator</title>

    <!-- Load MathJax for rendering LaTeX equations -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Include the html2pdf.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* Basic styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        .title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            padding: 20px 0;
        }

        .links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .link {
            font-size: 18px;
            cursor: pointer;
            text-decoration: underline;
            color: blue;
            padding: 5px 10px;
        }

        .download-button {
            display: none;
            text-align: center;
            margin-bottom: 20px;
        }

        .download-button button {
            cursor: pointer;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }

        /* Hidden PDF container */
        #pdfContainer {
            display: none;
            position: absolute;
            left: -9999px;
            font-size: 18px;
            line-height: 1.5;
            max-width: 800px;
            padding: 20px;
        }

        /* Styles to control page breaks in PDF */
        .pdf-page {
            page-break-inside: avoid;
            break-inside: avoid;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

    <div class="title">PHY1 PDF Generator</div>

    <!-- Links Section -->
    <div class="links">
        <!-- Links for weeks 2 to 12 -->
        <div class="link" onclick="selectWeek(2)">Woche 2</div>
        <div class="link" onclick="selectWeek(3)">Woche 3</div>
        <div class="link" onclick="selectWeek(4)">Woche 4</div>
        <div class="link" onclick="selectWeek(5)">Woche 5</div>
        <div class="link" onclick="selectWeek(6)">Woche 6</div>
        <div class="link" onclick="selectWeek(7)">Woche 7</div>
        <div class="link" onclick="selectWeek(8)">Woche 8</div>
        <div class="link" onclick="selectWeek(9)">Woche 9</div>
        <div class="link" onclick="selectWeek(10)">Woche 10</div>
        <div class="link" onclick="selectWeek(11)">Woche 11</div>
        <div class="link" onclick="selectWeek(12)">Woche 12</div>
    </div>

    <!-- Download Button -->
    <div class="download-button" id="downloadButtonContainer">
        <button onclick="generatePDF()">PDF herunterladen</button>
    </div>

    <!-- Hidden container for PDF content -->
    <div id="pdfContainer"></div>

    <!-- JavaScript code -->
    <script>
        let currentWeek = 0;
        let loadedQuestions = [];
        let weekTitleText = '';

        const weekTitles = {
            2: 'Physik Grundlagen',
            3: 'Impuls',
            4: 'Kinematik und Dynamik',
            // Add titles for other weeks if necessary
        };

        function selectWeek(weekNumber) {
            currentWeek = weekNumber;
            weekTitleText = weekTitles[weekNumber] || 'Physik Grundlagen';
            document.getElementById('downloadButtonContainer').style.display = 'block';
        }

        async function generatePDF() {
            if (currentWeek === 0) {
                alert('Bitte wählen Sie eine Woche aus.');
                return;
            }

            // Clear previous content
            loadedQuestions = [];
            const pdfContainer = document.getElementById('pdfContainer');
            pdfContainer.innerHTML = '';

            // Fetch and load the questions
            try {
                const response = await fetch(`Week${currentWeek}_questions.html`);
                if (!response.ok) {
                    throw new Error('Datei nicht gefunden');
                }
                const data = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(data, 'text/html');

                const questions = doc.querySelectorAll('h2[id^="question"]');

                if (questions.length === 0) {
                    alert('Keine Fragen für diese Woche gefunden.');
                    return;
                }

                // Create a title for the PDF
                const pdfTitle = document.createElement('h1');
                pdfTitle.innerText = weekTitleText + ' - Aufgaben';
                pdfContainer.appendChild(pdfTitle);

                // Questions
                questions.forEach((question, index) => {
                    const questionNumber = index + 1;
                    const questionContent = question.nextElementSibling ? question.nextElementSibling.outerHTML : '';

                    const hint = doc.querySelector(`#hint-${questionNumber}`);
                    const hintContent = hint && hint.nextElementSibling ? hint.nextElementSibling.outerHTML : '';

                    const solution = doc.querySelector(`#solution-${questionNumber}`);
                    const solutionContent = solution && solution.nextElementSibling ? solution.nextElementSibling.outerHTML : '';

                    // Store the question and solution content
                    loadedQuestions.push({
                        questionNumber: questionNumber,
                        questionContent: questionContent,
                        hintContent: hintContent,
                        solutionContent: solutionContent
                    });
                });

                // Build PDF content
                loadedQuestions.forEach((item) => {
                    const section = document.createElement('div');
                    section.className = 'pdf-page';

                    const questionHeading = document.createElement('h2');
                    questionHeading.innerText = `Aufgabe ${item.questionNumber}`;
                    section.appendChild(questionHeading);

                    const questionContentDiv = document.createElement('div');
                    questionContentDiv.innerHTML = item.questionContent;
                    section.appendChild(questionContentDiv);

                    if (item.hintContent) {
                        const hintHeading = document.createElement('h3');
                        hintHeading.innerText = 'Hinweis';
                        section.appendChild(hintHeading);

                        const hintContentDiv = document.createElement('div');
                        hintContentDiv.innerHTML = item.hintContent;
                        section.appendChild(hintContentDiv);
                    }

                    if (item.solutionContent) {
                        const solutionHeading = document.createElement('h3');
                        solutionHeading.innerText = 'Lösung';
                        section.appendChild(solutionHeading);

                        const solutionContentDiv = document.createElement('div');
                        solutionContentDiv.innerHTML = item.solutionContent;
                        section.appendChild(solutionContentDiv);
                    }

                    pdfContainer.appendChild(section);
                });

                // Ensure the container is visible for rendering
                pdfContainer.style.display = 'block';

                // Wait for MathJax to finish typesetting
                await MathJax.typesetPromise([pdfContainer]);

                // Use html2pdf.js to generate the PDF
                const opt = {
                    margin:       0.5,
                    filename:     `${weekTitleText}.pdf`,
                    image:        { type: 'jpeg', quality: 0.98 },
                    html2canvas:  { scale: 2, useCORS: true },
                    jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' },
                    pagebreak:    { mode: ['css', 'legacy'] }
                };

                await html2pdf().set(opt).from(pdfContainer).save();

                // Hide the container after PDF generation
                pdfContainer.style.display = 'none';
            } catch (error) {
                console.error('Fehler beim Laden der Fragen:', error);
                alert('Fehler beim Laden der Fragen.');
            }
        }
    </script>

</body>
</html>
