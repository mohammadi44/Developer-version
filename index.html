<!DOCTYPE html>
<html lang="de">
<head>
    <!-- Existing head content -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHY1 Interactive Questions</title>

    <!-- Load MathJax for rendering LaTeX equations -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Include the html2pdf.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

    <style>
        /* Your existing styles */
        /* ... (keep your existing CSS styles here) ... */
    </style>
</head>
<body class="showing-links">

    <div class="title" id="pageTitle">PHY1</div>

    <!-- Links Section -->
    <div class="links">
        <!-- Links for weeks 2 to 12 -->
        <!-- ... (keep your existing links here) ... -->
    </div>

    <!-- Question content -->
    <div id="weekContent" class="question-box">
        <!-- The title inside the question box -->
        <h2 id="weekTitle">Physik Grundlagen</h2>
        <div id="questionsContainer"></div>
    </div>

    <!-- Message when week content is missing -->
    <div id="missingWeekMessage" class="missing-week-message"></div>

    <!-- Navigation with centered question number and PDF button -->
    <div class="navigation">
        <div class="nav-buttons left-buttons">
            <button id="homeBtn" onclick="showHomepage()">Zurück zu den Links</button>
            <button id="firstQuestionBtn" onclick="goToFirstQuestion()">Zurück zur ersten Frage</button>
            <button id="downloadPdfBtn" onclick="downloadPDF()" style="display:none;">PDF herunterladen</button>
        </div>
        <span id="questionNumber" class="current-question">1/5</span>
        <div class="nav-buttons right-buttons">
            <button id="prevBtn" onclick="prevQuestion()" disabled>Vorherige</button>
            <button id="nextBtn" onclick="nextQuestion()">Nächste</button>
        </div>
    </div>

    <!-- JavaScript code -->
    <script>
        let currentQuestion = 1;
        let totalQuestions = 0;
        let currentWeek = 0; // To keep track of the current week

        // Mapping of week numbers to titles
        const weekTitles = {
            2: 'Physik Grundlagen',
            3: 'Impuls',
            4: 'Kinematik und Dynamik',
            // Add titles for other weeks if necessary
        };

        // Load questions from WeekX_questions.html
        function loadQuestions(weekNumber) {
            // ... (keep your existing loadQuestions function here) ...
        }

        // ... (keep your existing functions here) ...

        // Function to download the PDF
        function downloadPDF() {
            // Create a container for the PDF content
            const pdfContainer = document.createElement('div');
            pdfContainer.style.position = 'absolute';
            pdfContainer.style.left = '-9999px'; // Hide it off-screen
            pdfContainer.id = 'pdfContainer';

            // Clone and include CSS styles in the pdfContainer
            const styles = Array.from(document.querySelectorAll('style, link[rel="stylesheet"]'));
            styles.forEach(style => {
                if (style.tagName.toLowerCase() === 'style') {
                    const styleClone = document.createElement('style');
                    styleClone.textContent = style.textContent;
                    pdfContainer.appendChild(styleClone);
                } else if (style.tagName.toLowerCase() === 'link') {
                    const linkClone = document.createElement('link');
                    linkClone.rel = 'stylesheet';
                    linkClone.href = style.href;
                    pdfContainer.appendChild(linkClone);
                }
            });

            // Create a title for the PDF
            const pdfTitle = document.createElement('h1');
            pdfTitle.innerText = document.getElementById('weekTitle').innerText + ' - Aufgaben';
            pdfContainer.appendChild(pdfTitle);

            // Questions first
            const totalQuestions = document.querySelectorAll('.question-frame').length;

            for (let i = 1; i <= totalQuestions; i++) {
                // Clone the question content
                const questionElement = document.getElementById(`question${i}`).cloneNode(true);

                // Ensure the question is displayed
                questionElement.style.display = 'block';

                // Remove hint and solution buttons and content
                const buttons = questionElement.querySelector('.buttons');
                if (buttons) buttons.parentNode.removeChild(buttons);

                const hintElement = questionElement.querySelector('.hint-frame');
                if (hintElement) hintElement.parentNode.removeChild(hintElement);

                const solutionElement = questionElement.querySelector('.solution-frame');
                if (solutionElement) solutionElement.parentNode.removeChild(solutionElement);

                pdfContainer.appendChild(questionElement);
            }

            // Add a page break
            const pageBreak = document.createElement('div');
            pageBreak.style.pageBreakAfter = 'always';
            pdfContainer.appendChild(pageBreak);

            // Solutions next
            const solutionsTitle = document.createElement('h1');
            solutionsTitle.innerText = 'Lösungen';
            pdfContainer.appendChild(solutionsTitle);

            for (let i = 1; i <= totalQuestions; i++) {
                // Clone the question heading
                const questionHeading = document.createElement('h2');
                questionHeading.innerText = `Aufgabe ${i}`;
                pdfContainer.appendChild(questionHeading);

                // Clone the solution content
                const solutionElement = document.getElementById(`question${i}`).querySelector('.solution-frame').cloneNode(true);

                // Ensure the solution is displayed
                solutionElement.style.display = 'block';

                pdfContainer.appendChild(solutionElement);
            }

            // Append the container to the body
            document.body.appendChild(pdfContainer);

            // Debugging: Log the content of pdfContainer
            console.log('PDF Container content:', pdfContainer.innerHTML);

            // Ensure MathJax has typeset the content in pdfContainer
            MathJax.typesetPromise([pdfContainer]).then(() => {
                // Use html2pdf to generate the PDF
                const opt = {
                    margin:       1,
                    filename:     `${document.getElementById('weekTitle').innerText}.pdf`,
                    image:        { type: 'jpeg', quality: 0.98 },
                    html2canvas:  { scale: 2, useCORS: true },
                    jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
                };

                html2pdf().set(opt).from(pdfContainer).save().then(() => {
                    // Remove the temporary container
                    document.body.removeChild(pdfContainer);
                });
            });
        }

        // Initialize the page
        window.onload = function() {
            // ... (keep your existing window.onload function here) ...
        }
    </script>

</body>
</html>
